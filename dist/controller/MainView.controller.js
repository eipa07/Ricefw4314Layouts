sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/export/Spreadsheet","sap/m/MessageBox"],(e,t,i,r,s,o)=>{"use strict";var l=["VIRTUAL","MP","PT"];return e.extend("report.ricefw.controller.MainView",{onInit(){let e=new r({fecha:"",dateFrom:"",dateTo:"",invoices:[],material:[],po:[],cliente:"",parnr:"",lifnr:"",bukrs:[],visible_input_invoices:true,visible_input_matnr_ev:true,visible_input_matnr_pt:false,visible_input_po:true,visible_input_parnr:true,visible_input_lifnr:false,visible_input_numParte_mp:false,visible_input_cliente:true,visible_input_bukrs_ev:true,visible_input_bukrs_mp:false,visible_input_bukrs_pt:false,tableEV:true,tablePT:false,tableMP:false});this.getView().setModel(e,"requestModel");var t=new sap.ui.model.json.JSONModel;var i=new sap.ui.model.json.JSONModel;var s=new sap.ui.model.json.JSONModel;var o=new sap.ui.model.json.JSONModel;t.loadData("./model/MP_Layout.json",false);i.loadData("./model/PT_Layout.json",false);s.loadData("./model/Virtual_Layout.json",false);o.loadData("./model/Facturas.json",false);this.getView().setModel(t,"mpColumsModel");this.getView().setModel(i,"ptColumnsModel");this.getView().setModel(s,"veColumnsModel");this.getView().setModel(o,"facturasModel")},onVHParnrRequest:function(e){let r=e.getSource().getValue();this._parnrInputId=e.getSource().getId();if(!this._oVHParnrDialog){this._oVHParnrDialog=sap.ui.xmlfragment("report.ricefw.view.fragments.ParnrSelectionDialog",this);this.getView().addDependent(this._oVHParnrDialog)}this._oVHParnrDialog.getBinding("items").filter([new t("Parnr",i.Contains,r)]);this._oVHParnrDialog.open(r)},onVHSearchParnr:function(e){let r=e.getParameter("value");let s=new t("Parnr",i.Contains,r);let o=new t("ParnrDescription",i.Contains,r);var l=new t({filters:[s,o],and:false});e.getSource().getBinding("items").filter([l])},onVHCloseParnr:function(e){var t=e.getParameter("selectedItem");if(t){var i=this.getView().byId(this._parnrInputId);i.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},onVHLifnrRequest:function(e){let r=e.getSource().getValue();this._lifnrInputId=e.getSource().getId();if(!this._oVHLifnrDialog){this._oVHLifnrDialog=sap.ui.xmlfragment("report.ricefw.view.fragments.LifnrSelectionDialog",this);this.getView().addDependent(this._oVHLifnrDialog)}this._oVHLifnrDialog.getBinding("items").filter([new t("Lifnr",i.Contains,r)]);this._oVHLifnrDialog.open(r)},onVHSearchLifnr:function(e){let r=e.getParameter("value");let s=new t("Lifnr",i.Contains,r);let o=new t("LifnrName",i.Contains,r);var l=new t({filters:[s,o],and:false});e.getSource().getBinding("items").filter([l])},onVHCloseLifnr:function(e){var t=e.getParameter("selectedItem");if(t){var i=this.getView().byId(this._lifnrInputId);i.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},onVHBukrs_EV_Request:function(e){let r=e.getSource().getValue();this._bukrs_EV_InputId=e.getSource().getId();if(!this._oVHBukrs_EV_Dialog){this._oVHBukrs_EV_Dialog=sap.ui.xmlfragment("report.ricefw.view.fragments.Bukrs_EV_SelectionDialog",this);this.getView().addDependent(this._oVHBukrs_EV_Dialog)}this._oVHBukrs_EV_Dialog.getBinding("items").filter([new t("bukrs",i.Contains,r)]);this._oVHBukrs_EV_Dialog.open(r)},onVHSearchBukrs_EV:function(e){let r=e.getParameter("value");let s=new t("bukrs",i.Contains,r);let o=new t("butxt",i.Contains,r);var l=new t({filters:[s,o],and:false});e.getSource().getBinding("items").filter([l])},onVHCloseBukrs_EV:function(e){var t=e.getParameter("selectedItem");if(t){var i=this.getView().byId(this._bukrs_EV_InputId);i.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},onVHBukrs_MP_Request:function(e){let r=e.getSource().getValue();this._bukrs_MP_InputId=e.getSource().getId();if(!this._oVHBukrs_MP_Dialog){this._oVHBukrs_MP_Dialog=sap.ui.xmlfragment("report.ricefw.view.fragments.Bukrs_MP_SelectionDialog",this);this.getView().addDependent(this._oVHBukrs_MP_Dialog)}this._oVHBukrs_MP_Dialog.getBinding("items").filter([new t("bukrs",i.Contains,r)]);this._oVHBukrs_MP_Dialog.open(r)},onVHSearchBukrs_MP:function(e){let r=e.getParameter("value");let s=new t("bukrs",i.Contains,r);let o=new t("butxt",i.Contains,r);var l=new t({filters:[s,o],and:false});e.getSource().getBinding("items").filter([l])},onVHCloseBukrs_MP:function(e){var t=e.getParameter("selectedItem");if(t){var i=this.getView().byId(this._bukrs_MP_InputId);i.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},onVHBukrs_PT_Request:function(e){let r=e.getSource().getValue();this._bukrs_PT_InputId=e.getSource().getId();if(!this._oVHBukrs_PT_Dialog){this._oVHBukrs_PT_Dialog=sap.ui.xmlfragment("report.ricefw.view.fragments.Bukrs_PT_SelectionDialog",this);this.getView().addDependent(this._oVHBukrs_PT_Dialog)}this._oVHBukrs_PT_Dialog.getBinding("items").filter([new t("bukrs",i.Contains,r)]);this._oVHBukrs_PT_Dialog.open(r)},onVHSearchBukrs_PT:function(e){let r=e.getParameter("value");let s=new t("bukrs",i.Contains,r);let o=new t("butxt",i.Contains,r);var l=new t({filters:[s,o],and:false});e.getSource().getBinding("items").filter([l])},onVHCloseBukrs_PT:function(e){var t=e.getParameter("selectedItem");if(t){var i=this.getView().byId(this._bukrs_PT_InputId);i.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},_selectLayout:function(e){let t=e.getSource().getSelectedKey();console.log(t);if(l.filter(function(e){return e===t}).length>0){console.log(true);if(t==="VIRTUAL"){this.getView().getModel("requestModel").setProperty("/tableEV",true);this.getView().getModel("requestModel").setProperty("/tablePT",false);this.getView().getModel("requestModel").setProperty("/tableMP",false);this.getView().getModel("requestModel").setProperty("/visible_input_po",true);this.getView().getModel("requestModel").setProperty("/visible_input_invoices",true);this.getView().getModel("requestModel").setProperty("/visible_input_matnr_ev",true);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_ev",true);this.getView().getModel("requestModel").setProperty("/visible_input_matnr_pt",false);this.getView().getModel("requestModel").setProperty("/visible_input_parnr",true);this.getView().getModel("requestModel").setProperty("/visible_input_lifnr",false);this.getView().getModel("requestModel").setProperty("/visible_input_cliente",true);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_mp",false);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_pt",false);this.getView().getModel("requestModel").setProperty("/visible_input_numParte_mp",false)}else if(t==="MP"){this._loadRemoteOdataServices(l[1]);this.getView().getModel("requestModel").setProperty("/tableMP",true);this.getView().getModel("requestModel").setProperty("/tablePT",false);this.getView().getModel("requestModel").setProperty("/tableEV",false);this.getView().getModel("requestModel").setProperty("/visible_input_lifnr",true);this.getView().getModel("requestModel").setProperty("/visible_input_numParte_mp",true);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_mp",true);this.getView().getModel("requestModel").setProperty("/visible_input_po",false);this.getView().getModel("requestModel").setProperty("/visible_input_invoices",false);this.getView().getModel("requestModel").setProperty("/visible_input_matnr_ev",false);this.getView().getModel("requestModel").setProperty("/visible_input_matnr_pt",false);this.getView().getModel("requestModel").setProperty("/visible_input_parnr",false);this.getView().getModel("requestModel").setProperty("/visible_input_cliente",false);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_ev",false);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_pt",false)}else if(t==="PT"){this._loadRemoteOdataServices(l[2]);this.getView().getModel("requestModel").setProperty("/tablePT",true);this.getView().getModel("requestModel").setProperty("/tableMP",false);this.getView().getModel("requestModel").setProperty("/tableEV",false);this.getView().getModel("requestModel").setProperty("/visible_input_matnr_pt",true);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_pt",true);this.getView().getModel("requestModel").setProperty("/visible_input_matnr_ev",false);this.getView().getModel("requestModel").setProperty("/visible_input_lifnr",false);this.getView().getModel("requestModel").setProperty("/visible_input_po",false);this.getView().getModel("requestModel").setProperty("/visible_input_invoices",false);this.getView().getModel("requestModel").setProperty("/visible_input_parnr",false);this.getView().getModel("requestModel").setProperty("/visible_input_cliente",false);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_ev",false);this.getView().getModel("requestModel").setProperty("/visible_input_bukrs_mp",false);this.getView().getModel("requestModel").setProperty("/visible_input_numParte_mp",false)}}},matnrSelectionFinish:function(e){this.getView().getModel("requestModel").setProperty("/matnr","");var t=e.getParameter("selectedItems");let i=new Array;for(var r=0;r<t.length;r++){let e={Matnr:t[r].getKey(),Text:t[r].getText()};i.push(e)}this.getView().getModel("requestModel").setProperty("/matnr",i);console.log("fin matnr",this.getView().getModel("requestModel").getProperty("/matnr"))},invoicesSelectionFinish:function(e){this.getView().getModel("requestModel").setProperty("/invoices","");var t=e.getParameter("selectedItems");let i=new Array;for(var r=0;r<t.length;r++){let e={invoice:t[r].getKey(),invoiceName:t[r].getText()};i.push(e)}this.getView().getModel("requestModel").setProperty("/invoices",i);console.log("fin matnr",this.getView().getModel("requestModel").getProperty("/invoices"))},exportExcel:function(e){let t=this.validations();let i;if(t){var r;let t=this.byId(e);if(this.getView().getModel("requestModel").getProperty("/tableEV")){r="Layout Expo Virtuales.xlsx";i=l[0]}else if(this.getView().getModel("requestModel").getProperty("/tableMP")){r="Layout MP.xlsx";i=l[1]}if(this.getView().getModel("requestModel").getProperty("/tablePT")){r="Layout PT.xlsx";i=l[2]}let o=t.getBinding("rows");let n=this.getColums(i);let a={workbook:{columns:n,hierarchyLevel:"Level"},dataSource:o,fileName:r,worker:false};let g=new s(a);g.build().finally(function(){g.destroy()})}},getColums:function(e){var t;if(e===l[0]){t=this.getView().getModel("veColumnsModel").getData()}else if(e===l[1]){t=this.getView().getModel("mpColumsModel").getData()}else if(e===l[2]){t=this.getView().getModel("ptColumnsModel").getData()}return t},getLayout:function(e,t){var i=this;var s=this.getUrlFilters(e);t.read(s[0].url,{filters:s[0].filters,success:function(t,s){console.log(t);let o=new r;o.setData(t.results);if(e===l[0]){i.getView().setModel(o,"evLayoutModel")}else if(e===l[1]){i.getView().setModel(o,"mpLayoutModel")}else if(e===l[2]){i.getView().setModel(o,"ptLayoutModel")}},error:function(e){console.log(e)}})},getUrlFilters:function(e){var r=this.getView().getModel("requestModel").getData();var s=[];var o;let n=new Date(r.dateFrom);let a=parseInt(n.getMonth())+1;a=a<=9?"0"+a.toString():a.toString();let g=parseInt(n.getDate());g=g<=9?"0"+g.toString():g.toString();let u=n.getFullYear().toString()+a.toString()+g;let d=new Date(r.dateTo);let M=parseInt(d.getMonth())+1;M=M<=9?"0"+M.toString():M.toString();let _=parseInt(d.getDate());_=_<=9?"0"+_.toString():_.toString();let p=d.getFullYear().toString()+M.toString()+_;let f=u+"|"+p;var h=[];var V=this.getView().getModel("requestModel").getProperty("/bukrs");if(e===l[0]){o="/ZZ1_CDS_LAYOUT_EV(p_fecha='"+f+"')/Set?";var w=this.getView().getModel("requestModel").getProperty("/invoices");var c=this.getView().getModel("requestModel").getProperty("/po");var P=this.getView().getModel("requestModel").getProperty("/material");var v=this.getView().getModel("requestModel").getProperty("/cliente");if(w.length>0){for(let e=0;e<w.length;e++){h.push(new t("vbeln",i.EQ,w[e].vbeln))}}if(c.length>0){for(let e=0;e<c.length;e++){h.push(new t("ebeln",i.EQ,c[e].ebeln))}}if(P.length>0){for(let e=0;e<P.length;e++){h.push(new t("parn",i.EQ,P[e].Parnr))}}if(v){h.push(new t("kunnr",i.EQ,v))}}else if(e===l[1]){o="/ZZ1_CDS_LAYOUT_MP(p_fecha='"+f+"')/Set?";if(r.parnr){h.push(new t("Parnr",i.EQ,r.parnr))}if(r.lifnr){h.push(new t("Lifnr",i.EQ,r.lifnr))}}else if(e===l[2]){o="/ZZ1_CDS_LAYOUT_PT(p_fecha='"+f+"')/Set?";var m=this.getView().byId("MainView_MultiCB_Material_PT").getSelectedItems();if(m.length>0){m.forEach(e=>h.push(new t("Parnr",i.EQ,e.getKey())))}}if(V){if(V.length>0){for(let e=0;e<V.length;e++){h.push(new t("Bukrs",i.EQ,V[e].bukrs))}}}s.push([{url:o,filters:h}]);return s[0]},onSearchButton:function(){let e=this.validations();var t;if(e){if(this.getView().getModel("requestModel").getProperty("/tableEV")){t=this.getView().getModel("EV_LayoutService");if(this.getView().getModel("mpLayoutModel")){this.getView().getModel("mpLayoutModel").setData()}if(this.getView().getModel("ptLayoutModel")){this.getView().getModel("ptLayoutModel").setData()}this.getLayout(l[0],t)}else if(this.getView().getModel("requestModel").getProperty("/tableMP")){t=this.getView().getModel("MP_LayoutService");if(this.getView().getModel("evLayoutModel")){this.getView().getModel("evLayoutModel").setData()}if(this.getView().getModel("ptLayoutModel")){this.getView().getModel("ptLayoutModel").setData()}this.getLayout(l[1],t)}if(this.getView().getModel("requestModel").getProperty("/tablePT")){t=this.getView().getModel("PT_LayoutService");if(this.getView().getModel("evLayoutModel")){this.getView().getModel("evLayoutModel").setData()}if(this.getView().getModel("mpLayoutModel")){this.getView().getModel("mpLayoutModel").setData()}this.getLayout(l[2],t)}}},validations:function(){var e=this.getView().byId("MainView_DateRangeSelection").getValue();var t=true;if(!e){t=false;o.error("Elegir rango de fecha valido",{title:"Error",contentWidth:"30%",dependentOn:this.getView()})}return t},onDateChange:function(e){var t=e.getParameter("from"),i=e.getParameter("to"),r=e.getParameter("valid"),s=e.getSource();if(e.getParameter("valid")){this.getView().getModel("requestModel").setProperty("/dateFrom",t);this.getView().getModel("requestModel").setProperty("/dateTo",i)}else{o.error("Elegir rango de fecha valido",{title:"Error",contentWidth:"30%",dependentOn:this.getView()})}},_loadRemoteOdataServices:function(e){var t=this;if(e===l[1]){var i=this.getView().getModel("MP_LayoutService");if(!this.getView().getModel("numParte_MP_Model")){i.read("/ZZ1_CDS_SEARCH_HELP_PARNR/?",{success:function(e,i){console.log(e);let s=new r;s.setData(e.results);t.getView().setModel(s,"numParte_MP_Model")},error:function(e){console.log(e)}})}if(!this.getView().getModel("lifnr_MP_Model")){i.read("/ZZ1_CDS_SEARCH_HELP_LIFNR/?",{success:function(e,i){console.log(e);let s=new r;s.setData(e.results);t.getView().setModel(s,"lifnr_MP_Model")},error:function(e){console.log(e)}})}if(!this.getView().getModel("bukrs_MP_Model")){i.read("/ZZ1_CDS_SEARCH_HELP_BUKRS/?",{success:function(e,i){console.log(e);let s=new r;s.setData(e.results);t.getView().setModel(s,"bukrs_MP_Model")},error:function(e){console.log(e)}})}}else if(e===l[2]){var s=this.getView().getModel("PT_LayoutService");if(!this.getView().getModel("bukrs_PT_Model")){s.read("/ZZ1_CDS_SEARCH_HELP_BUKRS/?",{success:function(e,i){console.log(e);let s=new r;s.setData(e.results);t.getView().setModel(s,"bukrs_PT_Model")},error:function(e){console.log(e)}})}}},clearTable:function(e){if(this.getView().getModel("requestModel").getProperty("/tableEV")){if(this.getView().getModel("evLayoutModel")){this.getView().getModel("evLayoutModel").setData()}}else if(this.getView().getModel("requestModel").getProperty("/tableMP")){if(this.getView().getModel("mpLayoutModel")){this.getView().getModel("mpLayoutModel").setData()}}if(this.getView().getModel("requestModel").getProperty("/tablePT")){if(this.getView().getModel("ptLayoutModel")){this.getView().getModel("ptLayoutModel").setData()}}},invoicesSelectionFinish:function(e){var t=e.getParameter("selectedItems");var i=[];if(t.length>0){t.forEach(e=>i.push({vbeln:e.getProperty("key")}))}this.getView().getModel("requestModel").setProperty("/invoices",[]);this.getView().getModel("requestModel").setProperty("/invoices",i)},poSelectionFinish:function(e){var t=e.getParameter("selectedItems");var i=[];if(t.length>0){t.forEach(e=>i.push({ebeln:e.getProperty("key")}))}this.getView().getModel("requestModel").setProperty("/po",[]);this.getView().getModel("requestModel").setProperty("/po",i)},materialSelectionFinish:function(e){var t=e.getParameter("selectedItems");var i=[];if(t.length>0){t.forEach(e=>i.push({Parnr:e.getProperty("key")}))}this.getView().getModel("requestModel").setProperty("/material",[]);this.getView().getModel("requestModel").setProperty("/material",i)},bukrsSelectionFinish:function(e){var t=e.getParameter("selectedItems");var i=[];if(t.length>0){t.forEach(e=>i.push({bukrs:e.getProperty("key")}))}this.getView().getModel("requestModel").setProperty("/bukrs",[]);this.getView().getModel("requestModel").setProperty("/bukrs",i)},clearAllFilters:function(e){const t=this.byId(e);const i=t.getColumns();for(let e=0;e<i.length;e++){t.filter(i[e],null)}}})});
//# sourceMappingURL=MainView.controller.js.map